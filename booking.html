<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book a Lesson - Auto-Man Driving School</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="assets/config.js"></script>
  <script src="assets/render-helpers.js"></script>
  <script src="assets/include.js" defer></script>
  <link rel="stylesheet" href="css/styles.css">
  <link href="assets/theme.css" rel="stylesheet">
  <style>
    /* Smooth expand/collapse animation */
    .category-services {
      overflow: hidden;
      transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
      max-height: 2000px;
      opacity: 1;
    }
    .category-services.collapsed {
      max-height: 0;
      opacity: 0;
    }
    /* Chevron rotation animation */
    .chevron-icon {
      transition: transform 0.3s ease;
    }
    .chevron-icon.rotated {
      transform: rotate(-180deg);
    }
  </style>
</head>
<body class="bg-slate-900 text-white">
  <!-- Auth scripts (global Supabase client) MUST load before header -->
  <div data-include="partials/auth-scripts.html"></div>
  <!-- Header -->
  <div data-include="partials/header.html"></div>
  
  <!-- Main Content -->
  <main class="min-h-screen pt-8 pb-16">
    <section class="mx-auto max-w-3xl px-4 sm:px-6">
      <h1 class="text-3xl font-bold mb-4">Book a Driving Lesson</h1>
      <p class="text-slate-400 mb-8">Choose a lesson type below. You'll be taken to our secure Google booking page to select your preferred date and time.</p>

      <!-- Services (Auto-expanded categories) -->
      <div id="booking-services-container" class="space-y-8">
        <!-- Categories and services will be dynamically loaded from config -->
      </div>

      <div class="mt-10 p-6 bg-slate-800/50 rounded-xl">
        <h3 class="text-lg font-semibold mb-3">Booking Information</h3>
        <ul class="space-y-2 text-slate-300">
          <li class="flex items-start">
            <svg class="h-5 w-5 text-green-400 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span>Select your preferred time slot from the available options</span>
          </li>
          <li class="flex items-start">
            <svg class="h-5 w-5 text-green-400 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span>You'll receive a confirmation email with all the details</span>
          </li>
          <li class="flex items-start">
            <svg class="h-5 w-5 text-green-400 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            <span>24-hour cancellation policy applies</span>
          </li>
        </ul>
      </div>

      <p class="text-sm text-slate-500 mt-6 text-center">
        Booking opens in a new tab on calendar.google.com. Please ensure pop-ups are enabled for this site.
      </p>
    </section>
  </main>

  <!-- Footer -->
  <div data-include="partials/footer.html"></div>

  <script>
    // Render booking services on DOM ready
    document.addEventListener('DOMContentLoaded', function() {
      renderBookingServices();
    });

    function renderBookingServices() {
      const container = document.getElementById('booking-services-container');
      if (!container || !window.SITE_CONFIG || !window.SITE_CONFIG.BOOKING_CATEGORIES) {
        return;
      }

      const categories = window.SITE_CONFIG.BOOKING_CATEGORIES;
      
      categories.forEach((category, index) => {
        // Create category section
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'booking-category';
        
        // Category header (clickable to collapse/expand)
        const headerButton = document.createElement('button');
        headerButton.className = 'w-full text-left mb-4 flex items-center gap-3 group';
        headerButton.onclick = () => toggleCategory(category.id);
        headerButton.innerHTML = `
          <img src="${category.icon}" alt="${category.name}" class="w-8 h-8 object-contain">
          <h2 class="text-xl font-semibold tracking-tight flex-1">${category.name}</h2>
          <svg id="chevron-${category.id}" class="w-5 h-5 text-slate-400 chevron-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        `;
        
        // Services container (auto-expanded by default)
        const servicesDiv = document.createElement('div');
        servicesDiv.id = `services-${category.id}`;
        servicesDiv.className = 'space-y-3 category-services p-1';
        
        // Check if coming soon
        if (category.comingSoon) {
          const comingSoonDiv = document.createElement('div');
          comingSoonDiv.className = 'bg-[#101828] rounded-2xl p-4 shadow-sm ring-1 ring-white/10 flex items-center justify-center gap-3';
          comingSoonDiv.innerHTML = `
            <svg class="w-5 h-5 text-blue-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-gray-300 font-medium">Coming Soon</span>
          `;
          servicesDiv.appendChild(comingSoonDiv);
        } else {
          // Render each service
          category.services.forEach(service => {
            const serviceDiv = document.createElement('div');
            serviceDiv.className = 'group flex flex-wrap items-center gap-3 justify-between bg-[#101828] rounded-2xl p-4 shadow-sm ring-1 ring-white/10 hover:ring-blue-400/60 transition';
            
            serviceDiv.innerHTML = `
              <div class="min-w-0 flex-1">
                <p class="font-medium">${service.name} â€” ${service.duration}</p>
                <p class="text-xs text-gray-400">${service.description}</p>
              </div>
              <div class="flex items-center gap-4">
                <span class="text-gray-300 font-medium">$${service.price}</span>
                <a href="google-booking.html?bookingUrl=${encodeURIComponent(service.bookingUrl)}"
                   class="px-3 py-1.5 rounded-lg border border-blue-400 text-blue-400 hover:bg-blue-400 hover:text-white transition whitespace-nowrap">
                  Book Now
                </a>
              </div>
            `;
            
            servicesDiv.appendChild(serviceDiv);
          });
        }
        
        categoryDiv.appendChild(headerButton);
        categoryDiv.appendChild(servicesDiv);
        container.appendChild(categoryDiv);
      });
    }

    function toggleCategory(categoryId) {
      const servicesDiv = document.getElementById(`services-${categoryId}`);
      const chevron = document.getElementById(`chevron-${categoryId}`);
      
      if (!servicesDiv || !chevron) return;
      
      // Toggle collapsed class for smooth animation
      servicesDiv.classList.toggle('collapsed');
      chevron.classList.toggle('rotated');
    }
  </script>
</body>
</html>
